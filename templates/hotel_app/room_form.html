<!-- hotel_app/templates/hotel_app/room_form.html -->
{% extends "base.html" %}

{% block content %}
<div class="form-container" style="max-width: 800px; margin: 40px auto; padding: 20px;">
    <h1 style="color: #003366; margin-bottom: 30px; text-align: center;">{% if form.instance.pk %}Modifier{% else %}Ajouter{% endif %} une chambre</h1>

    {% if messages %}
    <div class="messages" style="margin-bottom: 20px;">
        {% for message in messages %}
        <div class="alert {% if message.tags %}alert-{{ message.tags }}{% endif %}"
             style="padding: 10px; border-radius: 4px; margin-bottom: 10px;">
            {{ message }}
        </div>
        {% endfor %}
    </div>
    {% endif %}

    <form method="POST" style="background: white; padding: 30px; border-radius: 8px; box-shadow: 0 2px 10px rgba(0,0,0,0.1);">
        {% csrf_token %}
        
        <div class="form-group" style="margin-bottom: 20px;">
            <label for="{{ form.hotel.id_for_label }}" style="display: block; margin-bottom: 5px; color: #666;">Hôtel</label>
            {{ form.hotel }}
            {% if form.hotel.errors %}
            <div class="error-message" style="color: #dc3545; font-size: 0.9em; margin-top: 5px;">
                {{ form.hotel.errors }}
            </div>
            {% endif %}
        </div>

        <div class="form-group" style="margin-bottom: 20px;">
            <label for="{{ form.room_type.id_for_label }}" style="display: block; margin-bottom: 5px; color: #666;">Type de chambre</label>
            {{ form.room_type }}
            {% if form.room_type.errors %}
            <div class="error-message" style="color: #dc3545; font-size: 0.9em; margin-top: 5px;">
                {{ form.room_type.errors }}
            </div>
            {% endif %}
        </div>

        <div class="form-group" style="margin-bottom: 20px;">
            <label for="{{ form.room_number.id_for_label }}" style="display: block; margin-bottom: 5px; color: #666;">Numéro de chambre</label>
            {{ form.room_number }}
            {% if form.room_number.errors %}
            <div class="error-message" style="color: #dc3545; font-size: 0.9em; margin-top: 5px;">
                {{ form.room_number.errors }}
            </div>
            {% endif %}
        </div>

        <div class="form-group" style="margin-bottom: 20px;">
            <label for="{{ form.floor.id_for_label }}" style="display: block; margin-bottom: 5px; color: #666;">Étage</label>
            {{ form.floor }}
            {% if form.floor.errors %}
            <div class="error-message" style="color: #dc3545; font-size: 0.9em; margin-top: 5px;">
                {{ form.floor.errors }}
            </div>
            {% endif %}
        </div>

        <div class="form-group" style="margin-bottom: 20px;">
            <label style="display: flex; align-items: center; color: #666; cursor: pointer;">
                {{ form.is_available }}
                <span style="margin-left: 8px;">Disponible</span>
            </label>
            {% if form.is_available.errors %}
            <div class="error-message" style="color: #dc3545; font-size: 0.9em; margin-top: 5px;">
                {{ form.is_available.errors }}
            </div>
            {% endif %}
        </div>

        <div class="form-actions" style="display: flex; justify-content: center; gap: 15px; margin-top: 30px;">
            <a href="{% url 'room-list' %}" class="btn-cancel" style="background-color: #6c757d; color: white; padding: 10px 20px; border-radius: 4px; text-decoration: none;">
                <i class="fas fa-times"></i> Annuler
            </a>
            <button type="submit" class="btn-submit" style="background-color: #28a745; color: white; padding: 10px 20px; border: none; border-radius: 4px; cursor: pointer;">
                <i class="fas fa-save"></i> Enregistrer
            </button>
        </div>
    </form>
</div>

<style>
    /* Style des champs de formulaire */
    input[type="text"],
    input[type="number"],
    select {
        width: 100%;
        padding: 8px 12px;
        border: 1px solid #ddd;
        border-radius: 4px;
        font-size: 16px;
    }

    input[type="text"]:focus,
    input[type="number"]:focus,
    select:focus {
        outline: none;
        border-color: #003366;
        box-shadow: 0 0 0 2px rgba(0,51,102,0.2);
    }

    /* Style des boutons */
    .btn-cancel:hover {
        background-color: #5a6268 !important;
    }

    .btn-submit:hover {
        background-color: #218838 !important;
    }

    /* Style de la case à cocher */
    input[type="checkbox"] {
        width: 18px;
        height: 18px;
        margin: 0;
    }
</style>

<script>
document.addEventListener('DOMContentLoaded', function() {
    const hotelSelect = document.getElementById('id_hotel');
    const roomTypeSelect = document.getElementById('id_room_type');

    // Fonction pour mettre à jour les types de chambres
    function updateRoomTypes() {
        const hotelId = hotelSelect.value;
        
        // Vider le select des types de chambres
        roomTypeSelect.innerHTML = '<option value="">---------</option>';
        
        if (hotelId) {
            // Faire une requête AJAX pour obtenir les types de chambres
            fetch(`/api/hotel/${hotelId}/room-types/`)
                .then(response => response.json())
                .then(data => {
                    data.forEach(roomType => {
                        const option = document.createElement('option');
                        option.value = roomType.id;
                        option.textContent = roomType.name;
                        roomTypeSelect.appendChild(option);
                    });
                });
        }
    }

    // Mettre à jour les types de chambres quand l'hôtel change
    hotelSelect.addEventListener('change', updateRoomTypes);
    
    // Mettre à jour les types de chambres au chargement de la page
    if (hotelSelect.value) {
        updateRoomTypes();
    }
});
</script>
{% endblock %} 